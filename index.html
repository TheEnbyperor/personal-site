<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>Q Misell</title>

    <link rel="stylesheet" href="/style.css">
</head>
<body>
<div class="term-container">
    <div id="term">
        <div class="term-head">
            <div class="head-btn minimise"></div>
            <div class="head-btn maximise"></div>
            <div class="head-btn close"></div>
        </div>
        <div class="content">
            <h1>Hi, I'm Q!</h1>
            <p>Welcome to my website. You can navigate around and learn about me using the terminal below.</p>
            <blockquote>
                Codes are a puzzle. A game, just like any other game.<br/>
                <em>- Alan Turing</em>
            </blockquote>
            <noscript>
                <p>This website requires javascript to function.</p>
            </noscript>
            <p>
                If you're on mobile here are some links to simulate text input;
            </p>
            <ul>
                <li><a href="#" class="text-link" data-text="ls" tabindex="-1">ls</a></li>
                <li><a href="#" class="text-link" data-text="cat about" tabindex="-1">cat about</a></li>
                <li><a href="#" class="text-link" data-text="cat email" tabindex="-1">cat email</a></li>
                <li><a href="#" class="text-link" data-text="cat github" tabindex="-1">cat github</a></li>
                <li><a href="#" class="text-link" data-text="cat github-sponsors" tabindex="-1">cat github-sponsors</a></li>
                <li><a href="#" class="text-link" data-text="cat twitter" tabindex="-1">cat twitter</a></li>
                <li><a href="#" class="text-link" data-text="cat irc" tabindex="-1">cat irc</a></li>
                <li><a href="#" class="text-link" data-text="cat xmpp" tabindex="-1">cat xmpp</a></li>
            </ul>
            <pre id="term-contents"></pre>
        </div>
    </div>
</div>
<footer>
    <p>
        &copy; 2021 Q Misell.
    </p>
</footer>
</body>

<script type="application/javascript">
    window.addEventListener("load", start);

    function start() {
        var term = document.getElementById("term-contents");
        var termContainer = term.parentElement;

        term.innerText += "> ";
        let cursor = document.createElement("span");
        cursor.className = "cursor";
        term.appendChild(cursor);

        var cmd_buffer = "";

        function handle_enter() {
            console.log(cmd_buffer);
            output_html(document.createElement("br"));
            if (cmd_buffer.length !== 0) {
                handle_cmd(cmd_buffer);
            }
            cmd_buffer = "";
            print_output("> ");
        }

        function handle_char(key) {
            print_output(key);
            cmd_buffer += key;
        }

        function print_output(text) {
            output_html(document.createTextNode(text));
        }

        function output_html(node) {
            term.insertBefore(node, cursor);
            termContainer.scrollTop = termContainer.scrollHeight - termContainer.clientHeight;
        }

        for (var link of document.getElementsByClassName("text-link")) {
            link.addEventListener("click", function (evt) {
                evt.target.blur();
                for (var char of evt.target.dataset.text) {
                    handle_char(char);
                }
                handle_enter();
            });
        }

        window.addEventListener("keydown", function (evt) {
            if (evt.isComposing || evt.keyCode === 229) {
                return;
            }
            evt.target.focus();

            if (evt.key.length === 1) {
                if (evt.altKey === false && evt.ctrlKey === false && evt.metaKey === false) {
                    handle_char(evt.key);
                }
            } else if (evt.key === "Backspace") {
                if (cmd_buffer.length !== 0) {
                    cmd_buffer = cmd_buffer.slice(0, -1);
                    term.removeChild(cursor.previousSibling);
                }
            } else if (evt.key === "Enter") {
                handle_enter()
            }
        });

        function split_cmd(cmd) {
            var out = [];
            var cmd_parts = [...cmd.matchAll(/((?:[^ \\]*\\.)+[^ ]*)|"([^"]+)"|'([^']+)'|([^ ]+)/g)];
            for (var part of cmd_parts) {
                if (typeof part[1] !== "undefined") {
                    out.push(part[1].replace(/(^|[^\\])\\(?!\\)/g, "$1").replace("\\\\", "\\"));
                } else if (typeof part[2] !== "undefined") {
                    out.push(part[2].replace(/^"(.*)"$/g, "$1"));
                } else if (typeof part[3] !== "undefined") {
                    out.push(part[3].replace(/^'(.*)'$/g, "$1"));
                } else if (typeof part[4] !== "undefined") {
                    out.push(part[4]);
                }
            }
            return out
        }

        function handle_cmd(cmd) {
            var cmd_parts = split_cmd(cmd);
            if (cmd_parts[0] === "pwd") {
                var link = document.createElement("a");
                link.innerText = "https://magicalcodewit.ch\n";
                link.href = "https://magicalcodewit.ch";
                link.tabIndex = -1;
                output_html(link);
            } else if (cmd_parts[0] === "ls") {
                print_output("about email github github-sponsors twitter irc xmpp\n")
            } else if (cmd_parts[0] === "cat") {
                if (cmd_parts[1] === "email") {
                    var link = document.createElement("a");
                    link.innerText = "q@magicalcodewit.ch\n";
                    link.href = "mailto:q@magicalcodewit.ch";
                    link.target = "_blank";
                    link.tabIndex = -1;
                    output_html(link);
                } else if (cmd_parts[1] === "github") {
                    var link = document.createElement("a");
                    link.innerText = "github.com/TheEnbyperor\n";
                    link.href = "https://github.com/TheEnbyperor";
                    link.target = "_blank";
                    link.tabIndex = -1;
                    output_html(link);
                } else if (cmd_parts[1] === "github-sponsors") {
                    print_output("Buy me a coffee at ");
                    var link = document.createElement("a");
                    link.innerText = "github.com/sponsors/TheEnbyperor\n";
                    link.href = "https://github.com/sponsors/TheEnbyperor";
                    link.target = "_blank";
                    link.tabIndex = -1;
                    output_html(link);
                } else if (cmd_parts[1] === "twitter") {
                    var link = document.createElement("a");
                    link.innerText = "@TheEnbyperor\n";
                    link.href = "https://twitter.com/TheEnbyperor";
                    link.target = "_blank";
                    link.tabIndex = -1;
                    output_html(link);
                } else if (cmd_parts[1] === "irc") {
                    var link = document.createElement("a");
                    link.innerText = "TheEnbyperor on libera.chat\n";
                    link.href = "ircs://irc.libera.chat:6697/TheEnbyperor";
                    link.target = "_blank";
                    link.tabIndex = -1;
                    output_html(link);
                } else if (cmd_parts[1] === "xmpp") {
                    var link = document.createElement("a");
                    link.innerText = "q@a3.pm\n";
                    link.href = "xmpp://q@a3.pm";
                    link.target = "_blank";
                    link.tabIndex = -1;
                    output_html(link);
                } else if (cmd_parts[1] === "about") {
                    var about = document.createElement("div");

                    var p = document.createElement("p");
                    p.innerText = "Hi I’m Q!";
                    about.appendChild(p);

                    var img = document.createElement("img")
                    img.src = "/pfp.png";
                    img.style.width = "100px";
                    about.appendChild(img);

                    p = document.createElement("p");
                    p.innerText = "Things to note about Q:";
                    about.appendChild(p);

                    var ul = document.createElement("ul");
                    var li = document.createElement("li")
                    li.innerText = "🧙🏻‍♀️ Is a witch 🧙🏻‍♀";
                    ul.appendChild(li);
                    li = document.createElement("li")
                    li.innerText = "✨ Sparkly ✨";
                    ul.appendChild(li);
                    li = document.createElement("li")
                    li.innerText = "📚 Guardian of the obscure standards 📚";
                    ul.appendChild(li);
                    li = document.createElement("li")
                    li.innerText = "🦀 Likes rust, perhaps a bit too much 🦀";
                    ul.appendChild(li);
                    about.appendChild(ul)

                    p = document.createElement("p");
                    p.innerText = "Supported locales:";
                    about.appendChild(p);

                    ul = document.createElement("ul");
                    li = document.createElement("li")
                    li.innerText = "🇬🇧 en_GB";
                    ul.appendChild(li);
                    li = document.createElement("li")
                    li.innerText = "🏴󠁧󠁢󠁷󠁬󠁳󠁿 cy_CY";
                    ul.appendChild(li);
                    about.appendChild(ul)

                    output_html(about);
                } else {
                    print_output("cat: No such file\n");
                }
            } else {
                print_output("Unknown command\n");
            }
        }
    }
</script>
</html>